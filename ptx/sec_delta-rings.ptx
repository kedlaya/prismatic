<section xml:id="sec_delta-rings">
  <title><m>\delta</m>-rings</title>
  <introduction>
    <paragraphs>
      <title>References</title>
      <p>
        We have followed <xref ref="bib-Bhatt-course"/>, Lecture 2, fairly closely. Some of the exercises were taken from <xref ref="bib-Borger-course"/>,
        others from <xref ref="bib-Bhatt-Scholze"/>, section 2.
      </p>
    </paragraphs>
    <p>
      In this section, we introduce the fundamental notion of a <term><m>\delta</m>-ring</term>.
      This definition was introduced by Joyal <xref ref="bib-Joyal1"/>, <xref ref="bib-Joyal2"/> with a view towards applications in <m>K</m>-theory; 
      it is closely related to the older notion of 
      a <term><m>\lambda</m>-ring</term>, which we will discuss briefly in the next section (<xref ref="subsec-big-Witt"/>).
      However, this development did not gain much attention until the same idea was rediscovered by Buium <xref ref="bib-Buium1"/> 
      under the guise of <term>arithmetic differentiation</term>.
      (Buium had the original goal of adapting Manin's proof of the finiteness of the set of torsion
      points on a hyperbolic algebraic curve embedded into its Jacobian from the function field case to the number field case;
      see <xref ref="bib-Buium2"/> for a slightly later treatment presenting arithmetic differentiation on its own terms.)
    </p>
    <definition>
      <p>
        For the remainder of the course (except as specified), fix a prime number <m>p</m>.
        Let <m>\Ring</m> denote the category of commutative unital rings.
        Let <m>\Rad(A)</m> denote the Jacobson radical of <m>A \in \Ring</m>.
        We say that <m>A</m> is <term><m>p</m>-local</term> if <m>p \in \Rad(A)</m>.
      </p>
    </definition>
  </introduction>
  <subsection>
    <title><m>p</m>-derivations and Frobenius lifts</title>
    <p>
      We begin by formalizing the fundamental idea of <q>differentiation with respect to a prime number</q>.
    </p>
    <definition xml:id="def-delta-ring">
      <p>
        Following Joyal, we define a <term><m>\delta</m>-ring</term> to be a pair <m>(A, \delta)</m> in which <m>A \in \Ring</m> and <m>\delta: A \to A</m>
        is a map of sets satisfying the following conditions for all <m>x,y \in A</m>.
        <mdn>
          <mrow xml:id="eq-delta-ring-value-at-1">\delta(1) = 0;</mrow>
          <mrow xml:id="eq-delta-ring-product">\delta(xy) = x^p \delta(y) + y^p \delta(x) + p \delta(x) \delta(y);</mrow>
          <mrow xml:id="eq-delta-ring-sum">\delta(x+y) = \delta(x) + \delta(y) - \sum_{i=1}^{p-1} \frac{(p-1)!}{i!(p-i)!} x^i y^{p-i}.</mrow>
        </mdn>
        The last condition implies that
        <me>
          p (\delta(x+y) - \delta(x) - \delta(y)) = x^p + y^p - (x+y)^p
        </me>
        and conversely if <m>A</m> is <m>p</m>-torsion-free. (In some sources, a map <m>\delta</m> satisfying these conditions is called a <term><m>p</m>-derivation</term>.)
      </p>
      <p>
        We will habitually abuse notation and terminology and say that <q><m>A</m> is a <m>\delta</m>-ring</q> when it is meant to be clear from context what the map <m>\delta</m> is supposed to be.
        We will also apply adjectives to a <m>\delta</m>-ring (e.g., <q><m>p</m>-torsion-free</q>) when they are meant to apply to the underlying ring.
      </p>
    </definition>
    <remark>
      <p>
        Note that <xref ref="eq-delta-ring-sum"/> also implies that <m>\delta(0) = 0</m>, so we don't need to include this condition separately.
        By contrast, <xref ref="eq-delta-ring-product"/> does not by itself imply that <m>\delta(1) = 0</m>; see <xref ref="exer-delta-ring-normalization"/>.
      </p>
    </remark>
    <p>
      The form of the previous definition is partly explained by the following construction.
    </p>
    <lemma xml:id="lem-delta-ring-Frobenius-lift">
      <statement>
        <p>
          Choose <m>A \in \Ring</m>.
        </p>
        <ol>
          <li>
            <p>
              Suppose that <m>\delta: A \to A</m> is a <m>p</m>-derivation (that is, <m>(A, \delta)</m> is a <m>\delta</m>-ring).
              Then the map <m>\phi: A \to A</m> given by 
              <me>
                \phi(x) = x^p + p \delta(x)
              </me>
              is a ring homomorphism that induces the Frobenius endomorphism on <m>A/pA</m>
              (a/k/a a <term>Frobenius lift</term> on <m>A</m>).
              We will refer to <m>\phi</m> as the <term>associated Frobenius lift</term> on <m>(A, \delta)</m>.
            </p>
          </li>
          <li>
            <p>
              If <m>A</m> is <m>p</m>-torsion-free, then this construction defines a bijection between <m>p</m>-derivations on <m>A</m> and Frobenius lifts on <m>A</m>.
            </p>
          </li>
        </ol>
      </statement>
      <proof>
        <p>
          It was already pointed out in <xref ref="def-delta-ring"/> that <m>\delta</m> satisfies <xref ref="eq-delta-ring-sum"/> if and only if 
          <m>\phi</m> is additive, and conversely if <m>A</m> is <m>p</m>-torsion-free. Meanwhile, <xref ref="eq-delta-ring-value-at-1"/> implies that <m>\phi(1) = 0</m>,
          and conversely if <m>A</m> is <m>p</m>-torsion-free; while <xref ref="eq-delta-ring-product"/> implies that <m>\phi(xy) = \phi(x) \phi(y)</m>,
          and conversely if <m>A</m> is <m>p</m>-torsion-free.
        </p>
      </proof>
    </lemma>
    <definition>
      <p>
        By <xref ref="eq-delta-ring-value-at-1"/> and <xref ref="eq-delta-ring-product"/>, in any <m>\delta</m>-ring <m>A</m> the elements <m>x \in A</m> for which <m>\delta(x) = 0</m> form a monoid under multiplication.
        By analogy with the case of an ordinary derivation, we call these the <term><m>\delta</m>-constant elements</term> of <m>A</m>.
        These elements also satisfy <m>\phi(x) = x^p</m>, and conversely if <m>A</m> is <m>p</m>-torsion free.
        (In <xref ref="bib-Bhatt-Scholze"/> these elements are said to be <term>of rank 1</term>; this terminology will make more sense in the 
        context of big Witt wectors, as in <xref ref="rmk-Almkvist-interpretation"/>.)
      </p>
    </definition>
    <remark>
      <p>
        One might ask to what extent the notion of a <m>p</m>-derivation is a <q>natural</q> modification of the definition of a usual derivation.
        One answer to this question can be found in <xref ref="bib-Buium2"/>: one can define the notion of a <term>jet operator</term> <m>\delta</m>
        on a local domain <m>A</m> of characteristic 0 and show that any such map is either an ordinary derivation, a <m>\pi</m>-difference operator
        for some <m>\pi \in A</m> (i.e., <m>x \mapsto x + \pi \delta(x)</m> is a ring homomorphism), or a <m>\pi</m>-derivation for some <m>\pi \in A</m>
        dividing a prime <m>p</m> (where <m>x \mapsto x^q + \pi \delta(x)</m> is a ring homomorphism for some power of <m>p</m>). This can be thought of
        as a loose analogue of Ostrowski's classification of valuations.
      </p>
    </remark>
  </subsection>
  <subsection>
    <title>Examples of <m>\delta</m>-rings</title>
    <p>
      Using <xref ref="lem-delta-ring-Frobenius-lift"/>, it is not difficult to generate examples of <m>\delta</m>-rings. Here are a few illustrative cases.
    </p>
    <example xml:id="exa-delta-ring-p-invertible">
      <p>
        If <m>p</m> is invertible in the ring <m>A</m>, then <em>every</em> endomorphism of <m>A</m> is a Frobenius lift, and thus gives rise to a <m>p</m>-derivation.
      </p>
    </example>
    <example xml:id="exa-delta-ring-Z">
      <p>
        By <xref ref="lem-delta-ring-Frobenius-lift"/>, there is a unique way to equip <m>\ZZ</m> with the structure of a <m>\delta</m>-ring, namely via the map
        <men xml:id="eq-delta-on-Z">
          \delta(x) = \frac{x^p-x}{p}.
        </men>
        The <m>\delta</m>-constant elements are <m>\{0,1\}</m>.
      </p>
      <p>
        By the same token, <m>\ZZ_p</m> has trivial automorphism group (even if we ignore its topology!) and so 
        admits a unique <m>\delta</m>-ring structure. The <m>\delta</m>-constant elements are <m>\{0\} \cup \mu_{p-1}</m>.
        This example is the first case of the general construction of rings of Witt vectors; see <xref ref="subsec-Witt-vectors"/>.
      </p>
    </example>
    <remark xml:id="rmk-delta-ring-image-of-Z">
      <p>
        Using <xref ref="eq-delta-ring-sum"/>, we can start from the equality <m>\delta(0) = \delta(1) = 1</m> and reconstruct the values of <m>\delta</m>
        on arbitrary integers. Consequently, for any <m>\delta</m>-ring <m>A</m>, the action of <m>\delta</m> on integers is given by
        <xref ref="eq-delta-on-Z"/> <em>even if <m>A</m> is not <m>p</m>-torsion-free</em>. In particular, for any positive integer <m>n</m>,
        <me>
          \delta(p^n) = p^{n-1} (1 - p^{n(p-1)})
        </me>
        and the second factor is not divisible by <m>p</m> unless <m>p</m> is invertible in <m>A</m> (see <xref ref="exa-delta-ring-p-invertible"/>);
        that is, <m>\delta</m> <q>lowers the <m>p</m>-adic order of vanishing by 1</q>.
        By the same token, for any <m>x \in A</m>,
        <me>
          \delta(p^n x) = p^{np} \delta(x) + x^p \delta(p^n) + p \delta(x) \delta(p^n) \equiv p^{n-1} x^p \pmod{p^n}.
        </me>
      </p>
    </remark>
    <example xml:id="exa-delta-ring-cyclotomic">
      <p>
        Building on <xref ref="exa-delta-ring-Z"/>, take <m>A = \ZZ[\mu_n: \gcd(n,p) = 1]</m>. The automorphism <m>\phi: A \to A</m> taking <m>\zeta_n</m>
        to <m>\zeta_n^p</m> for every positive integer <m>n</m> coprime to <m>p</m> is a Frobenius lift; for <m>\delta</m> the corresponding <m>p</m>-derivation, the
        <m>\delta</m>-constant elements are <m>\{0\} \cup \bigcup_{\gcd(n,p)=1} \mu_n</m>.
      </p>
    </example>
    <example xml:id="exa-delta-ring-polynomial">
      <p>
        Take <m>A = \ZZ[x]</m>. For any <m>y \in A</m>, there is a unique Frobenius lift <m>\phi</m> of <m>A</m> for which <m>\phi(x) = x^p + py</m>;
        consequently, there is a unique <m>p</m>-derivation <m>\delta</m> on <m>A</m> with <m>\delta(x) = y</m>. It is tempting to interpret this as the statement that
        <q>the set of <m>p</m>-derivations on <m>A</m> is a free <m>A</m>-module of rank <m>1</m></q>, but in fact there is no natural module structure
        on the set of <m>p</m>-derivations on a general ring.
      </p>
    </example>
    <p>
      You may have noticed that none of these examples has <m>p</m>-torsion. That is not entirely an accident.
    </p>
    <lemma xml:id="lem-delta-ring-killed-by-p">
      <statement>
        <p>
          Let <m>(A, \delta)</m> be a <m>\delta</m>-ring such that for some nonnegative integer <m>n</m>, <m>p^n = 0</m> in <m>A</m>. Then <m>A = 0</m>.
        </p>
      </statement>
      <proof>
        <p>
          We prove the claim by induction on <m>n</m>, with the base case <m>n=0</m> being vacuously true.
        </p>
        <p>
          Suppose that <m>n>0</m>. Then <m>A</m> is a <m>\ZZ_{(p)}</m>-algebra. Consequently,
          by <xref ref="eq-delta-on-Z"/> and <xref ref="rmk-delta-ring-image-of-Z"/>, 
          <me>
            0 = \delta(0) = \delta(p^n) = p^{n-1} (1 - p^{np-n})
          </me>
          and the second factor is a unit in <m>A</m>. Hence <m>p^{n-1} = 0</m> in <m>A</m> also, and the induction hypothesis applies.
        </p>
      </proof>
    </lemma>
    <remark>
      <p>
        Notwithstanding <xref ref="lem-delta-ring-killed-by-p"/>, there do exist examples of <m>\delta</m>-rings in which the 
        underlying ring is not <m>p</m>-torsion-free; it is difficult to write these down concretely (in part because it is not enough to specify the
        associated Frobenius lift), but they will be generated naturally by <xref ref="def-delta-ring-right-adjoint"/>.
        See for instance <xref ref="exer-delta-ring-nontrivial-torsion"/>.
      </p>
      <p>
        Fortunately, quite often we can ignore these examples when checking basic properties of <m>\delta</m>-rings by appealing to the existence of free <m>\delta</m>-rings; see again <xref ref="def-delta-ring-left-adjoint"/>.
        See also <xref ref="exer-delta-ring-p-power-torsion"/> for a variant of <xref ref="lem-delta-ring-killed-by-p"/> that applies to this situation.
      </p>
    </remark>
    <lemma xml:id="lem-delta-p-torsion">
      <statement>
        <p>
          Let <m>A</m> be a <m>\delta</m>-ring. For any <m>x \in A</m> with <m>px = 0</m>, <m>\phi(x) = 0</m>.
          In particular, if <m>\phi</m> is injective, then <m>A</m> is <m>p</m>-torsion-free.
        </p>
      </statement>
      <proof>
        <p>
          Since <m>x</m> maps to zero in <m>A[p^{-1}]</m>, so then does <m>\phi(x)</m>. It is thus sufficient to check the claim after localizing at <m>(p)</m>,
          that is, we may assume that <m>A</m> is a <m>\ZZ_{(p)}</m>-algebra. Now apply <xref ref="eq-delta-ring-product"/> to write
          <me>
            0 = \delta(0) = \delta(px) = x^p \delta(p) + p^p \delta(x) + p \delta(x) \delta(p) = p^p \delta(x) + \phi(x) \delta(p).
          </me>
          By <xref ref="rmk-delta-ring-image-of-Z"/>, <m>\delta(p)</m> is a unit in <m>A</m>; it will thus suffice to check that <m>p^p \delta(x) = 0</m>. This follows by writing
          <me>
            p^p \delta(x) = p^{p-1} (\phi(x) - x^p) = p^{p-2} (\phi(px) - px^p) = 0.
          </me>
        </p>
      </proof>
    </lemma>
  </subsection>
  
  <subsection xml:id="subsec-truncated-Witt">
    <title>Truncated Witt vectors</title>
    <p>
      Just as derivations can be naturally interpreted as giving first-order deformations of a ring, one can interpret <m>p</m>-derivations in the following manner.
    </p>
    <definition xml:id="def-W2-interpretation">
      <p>
        For <m>A</m> a ring, let <m>W_2(A)</m> be the set <m>A \times A</m> equipped with binary operations <m>+, \times</m> defined as follows:
        <md>
          <mrow>(x_0, x_1) + (y_0, y_1) &amp;= (x_0+y_0, x_1+y_1 - \sum_{i=1}^{p-1} \frac{(p-1)!}{i!(p-i)!} x_0^i y_0^{p-i})</mrow>
          <mrow>(x_0, x_1) \times (y_0, y_1) &amp;= (x_0 x_1, x_0^p y_1 + y_0^p x_1 + p x_1 y_1).</mrow> 
        </md>
        Note the relation of these formulas to the definition of a <m>\delta</m>-ring (<xref ref="def-delta-ring"/>).
      </p>
    </definition>
    <lemma xml:id="lem-W2-ring">
      <statement>
        <p>
          The set <m>W_2(A)</m> with the operations <m>+, \times</m> is a commutative ring.
          Moreover, the operation <m>A \mapsto W_2(A)</m> defines a functor from <m>\Ring</m> to <m>\Ring</m>.
        </p>
      </statement>
      <proof>
        <p>
          One may see directly from the definitions that:
          <ul>
            <li>
              <p>
                addition is commutative and the element <me>0 = (0, 0)</me> is an identity element;
              </p>
            </li>
            <li>
              <p>
                every element has an additive inverse;
              </p>
            </li>
            <li>
              <p>
                multiplication is commutative and the element <m>1 = (1, 0)</m> is an identity element;
              </p>
            </li>
            <li>
              <p>
                the operation <m>A \mapsto W_2(A)</m> defines a functor from the category of commutative rings to the category of sets equipped with
                two binary operations.
              </p>
            </li>
          </ul>
          We thus need to check that addition and multiplication are associative and that multiplication distributes over addition.
          These are all conditions asserting the validity of certain polynomial identities in two arbitrary elements <m>x,y \in A</m>;
          thanks to the functoriality, these can be checked after lifting from <m>A</m> to some ring that surjects onto it. In particular,
          we may take <m>A</m> to be a polynomial ring over <m>\ZZ</m>, which in particular is <m>p</m>-torsion-free.
        </p>
        <p>
          In this setting, the map
          <me>
            W_2(A) \to A \times A, \qquad (x_0, x_1) \mapsto (x_0, x_0^p + px_1)
          </me>
          is an injective morphism of sets with two operations for the <em>usual</em> ring operations on <m>A \times A</m>.
          Consequently, we may deduce the desired properties by transferring the knowledge from <m>A \times A</m>.
          (This map is related to the <term>ghost map</term> on Witt vectors; see <xref ref="subsec_ghost"/>.)
        </p>
      </proof>
    </lemma>
    <remark xml:id="rmk-W2-interpretation">
      <p>
        Ignoring the second component defines a ring homomorphism <m>\epsilon: W_2(A) \to A</m>. In this notation, a <m>\delta</m>-ring structure on <m>A</m>
        corresponds to a ring homomorphism <m>w: A \to W_2(A)</m> such that <m> \epsilon \circ w = \id_A</m>.
        In this way, the ring <m>W_2(A)</m> plays a role comparable to that of the <term>ring of dual numbers</term> <m>k[\epsilon]/(\epsilon^2)</m> over a field <m>k</m>.
      </p>
    </remark>
    <remark>
      <p>
        For <m>A</m> a <m>p</m>-torsion-free ring, <m>W_2(A)</m> can also be described as the fiber product of the reduction map <m>A \to A/(p)</m>
        with the composition <m>A \to A/(p) \stackrel{\phi}{\to} A/(p)</m> where <m>\phi</m> denotes the Frobenius on <m>A/(p)</m>. That is,
        <m>\Spec W_2(A)</m> consists of two copies of <m>\Spec A</m> glued along <m>\Spec A/(p)</m> via Frobenius.
      </p>
      <p>
        In <xref ref="bib-Bhatt-course"/>, Lecture 2, Remark 3.4, Bhatt also suggests a version of this statement without the <m>p</m>-torsion-free condition:
        for a general ring <m>A</m>, a <m>\delta</m>-structure on <m>A</m> corresponds to an endomorphism <m>\phi: A \to A</m> which is a <q>derived Frobenius lift</q>.
        That is, for <m>\overline{A} = A \otimes^L_{\ZZ} \ZZ/(p)</m>,
        there exists (and is specified!) a homotopy between the composition <m>A \stackrel{\phi}{\to} A \to \overline{A}</m>
        and the composition <m>A \to \overline{A} \stackrel{\mathrm{Frob}}{\to} \overline{A}</m>. This description follows from the previous discussion by interpreting
        <m>W_2(A)</m> as the fiber product of <m>A \to \overline{A}</m> and <m>A \to \overline{A} \stackrel{\mathrm{Frob}}{\to} \overline{A}</m>.
      </p>
    </remark>
  </subsection>
  <subsection>
    <title>The category of <m>\delta</m>-rings</title>
    <definition>
      <p>
        A <term>morphism</term> of <m>\delta</m>-rings <m>(A, \delta) \to (A', \delta')</m> is a homomorphism <m>f: A \to A'</m> of rings such that <m>f \circ \delta = \delta' \circ f</m>  (again as maps of sets only).
        It is evident that with this definition, <m>\delta</m>-rings form a category, denoted <m>\Ring_\delta</m>.
      </p>
    </definition>
    <lemma xml:id="lem-delta-ring-quotient">
      <statement>
        <p>
          Let <m>A</m> be a <m>\delta</m>-ring. Let <m>I</m> be an ideal of <m>A</m> such that <m>\delta(I) \subseteq I</m>. Then
          <m>A/I</m> admits a unique <m>\delta</m>-ring structure compatible with the map <m>A \to A/I</m>.
        </p>
      </statement>
      <proof>
        <p>
          All we need to check is that if <m>x \equiv y \pmod{I}</m>, then <m>\delta(x) \equiv \delta(y) \pmod{I}</m>.
          This is apparent from <xref ref="eq-delta-ring-sum"/>, which implies that <m>\delta(x) \equiv \delta(y) + \delta(x-y) \pmod{x-y}</m>.
        </p>
      </proof>
    </lemma>
    <lemma xml:id="lem-delta-ring-limits-colimits">
      <title>Limits and colimits</title>
      <statement>
        <p>
          The category <m>\Ring_\delta</m> admits arbitrary limits and colimits. Moreover, the formation of these commutes with the forgetful functor to <m>\Ring</m>.
        </p>
      </statement>
      <proof>
        <p>
          For limits, this is pretty straightforward. For colimits, it is perhaps easiest to use <xref ref="rmk-W2-interpretation"/>: if <m>A</m>
          is the colimit of a diagram <m>\{A_i\}</m>, then we get a map <m>\colim A_i \to \colim W_2(A_i) = W_2(\colim A_i)</m> splitting the projection map,
          and then we recover a <m>\delta</m>-structure on <m>\colim A_i</m>.
        </p>
      </proof>
    </lemma>
    <remark>
      <p>
        The analogue of <xref ref="lem-delta-ring-limits-colimits"/> fails for the category of rings with a Frobenius lift; see <xref ref="exer-category-Frobenius-lift"/>.
        This is one reason why to prefer the category of <m>\delta</m>-rings as a basic object of study.
      </p>
    </remark>
    <definition xml:id="def-delta-ring-left-adjoint">
      <p>
        By <xref ref="lem-delta-ring-limits-colimits"/> plus Freyd's adjoint functor theorem (see <xref ref="bib-Maclane"/>, section V.8), 
        the forgetful functor <m>\Ring_\delta \to \Ring</m> admits both a left adjoint and a right adjoint.        
        The right adjoint gives rise to Witt vectors; see <xref ref="sec_Witt"/>.
      </p>
      <p>
        The left adjoint can be described concretely in the case of the polynomial ring <m>\ZZ[S]</m> (for <m>S</m> an arbitrary set, not necessarily finite); it produces
        the <term>free <m>\delta</m>-ring</term> on <m>S</m> which we denote by <m>\ZZ\{S\}</m>.
        Concretely, the underlying ring of <m>\ZZ\{S\}</m> is given by <m>\ZZ[S_0, S_1, \dots]</m> where each <m>S_i</m> is a copy of <m>S</m>. The map <m>\delta</m> acts on these elements as follows:
        for <m>s \in S</m> corresponding to <m>s_i \in S_i</m>, we have <m>\delta(s_i) = s_{i+1}</m>.
        (To evaluate the left adjoint on an arbitrary ring, we can write it as a quotient of <m>\ZZ[S]</m> for some <m>S</m>, say by using the adjunction between
        commutative rings and sets, and then take a quotient of the resulting free <m>\delta</m>-ring using <xref ref="lem-delta-ring-quotient"/>.)
      </p>
      <p>
        An important corollary of this observation is that every <m>\delta</m>-ring can be written as a quotient of a <m>p</m>-torsion-free <m>\delta</m>-ring;
        this will allow us to reduce many computations to the <m>p</m>-torsion-free case.
      </p>
    </definition>
    <remark>
      <p>
        Note that in <xref ref="def-delta-ring-left-adjoint"/>, applying the left adjoint to a finitely generated polynomial ring over <m>\ZZ</m> produces a <m>\delta</m>-ring
        whose underlying ring is <em>not noetherian</em>. This suggests that we cannot entertain any hope of staying within the noetherian realm as we go along.
        This is similar to what happens in <term>difference algebra</term>, the study of rings equipped with an endomorphism.
      </p>
    </remark>
    <lemma>
      <statement>
        <p>
          Let <m>(A, \delta)</m> be a <m>\delta</m>-ring and let <m>\phi</m> be the associated Frobenius lift.
          Then <m>\phi</m> is an endomorphism of <m>(A, \delta)</m>.
        </p>
      </statement>
      <proof>
        <p>
          We are claiming that <m>\delta \circ \phi = \phi \circ \delta</m>; this is a polynomial identity on a single element <m>x \in A</m> and its image under <m>\delta</m>, so by
          lifting to a free <m>\delta</m>-ring using <xref ref="def-delta-ring-left-adjoint"/>,
          we may reduce to the case where <m>A</m> is <m>p</m>-torsion-free. In this case, the claim reduces to checking
          that <m>\phi</m> is an endomorphism of the difference ring <m>(A, \phi)</m>, which is obviously true.
        </p>
      </proof>
    </lemma>
    <lemma xml:id="lem-delta-ring-localization">
      <statement>
        <p>
          Let <m>A</m> be a <m>\delta</m>-ring. Let <m>S</m> be a multiplicative subset of <m>A</m> such that <m>\phi(S) \subseteq S</m>.
          Then there is a unique way to equip <m>S^{-1} A</m> with the structure of a <m>\delta</m>-ring so that the localization homomorphism
          <m>A \to S^{-1} A</m> becomes a morphism of <m>\delta</m>-rings.
        </p>
      </statement>
      <proof>
        <p>
          Suppose first that <m>A</m> is <m>p</m>-torsion-free; then so is <m>S^{-1} A</m>. Since <m>\phi(S) \subseteq S</m>, the map <m>\phi: A \to A</m>
          extends uniquely to a morphism <m>\phi: S^{-1} A \to S^{-1} A</m> which is again a Frobenius lift. We thus recover a unique <m>\delta</m>-structure
          on <m>S^{-1} A</m>.
        </p>
        <p>
          In the general case, form a surjection <m>F \to A</m> of <m>\delta</m>-rings with <m>F</m> being <m>p</m>-torsion-free.
          Let <m>T</m> be the preimage of <m>S</m> in <m>F</m>; it is again a multiplicative subset such that <m>\phi(T) \subseteq T</m>, so we 
          may uniquely promote <m>T^{-1} F</m> to a <m>\delta</m>-ring over <m>T</m>. Since <xref ref="fig-delta-rings-1"/>
          is a pushout diagram in <m>\Ring</m>, the pushout in <m>\Ring_\delta</m> (which is a colimit, and hence covered by <xref ref="lem-delta-ring-limits-colimits"/>)
          gives us the unique <m>\delta</m>-ring structure on <m>S^{-1} A</m>. (One can also argue more explicitly using <xref ref="lem-delta-ring-quotient"/>.)
        </p>
        <figure xml:id="fig-delta-rings-1">
          <image width="25%">
            <latex-image>
              \xymatrix{
                F \ar[r] \ar[d] &amp; T^{-1} F \ar[d] \\
                A \ar[r] &amp; S^{-1} A
              }
            </latex-image>
          </image>
        </figure>
      </proof>
    </lemma>
    <remark xml:id="rmk-delta-ring-localization">
      <p>
        An important special case of <xref ref="lem-delta-ring-localization"/> is localization at a closed subscheme on which <m>p</m> vanishes,
        taking <m>S</m> to be the complement of the radical ideal defining this subscheme. 
        In this case, the hypothesis <m>\phi(S) \subseteq S</m> is automatically satisfied.
      </p>
    </remark>
    <remark>
        <p>
          We do not know whether the following natural generalization of <xref ref="lem-delta-ring-localization"/> holds: 
          if <m>A</m> is a <m>\delta</m>-ring and <m>A \to B</m> is an étale morphism of rings,
          then the ways to promote this to a morphism
          of <m>\delta</m>-rings correspond precisely to the ways to extend the action of <m>\phi</m> on <m>A</m> to <m>B</m>.
          (This is true if <m>A</m> is <m>p</m>-torsion-free, but the reduction to this case is a bit subtle.)
        </p>
    </remark>
  </subsection>
  <exercises>
    <exercise xml:id="exer-delta-ring-normalization">
      <statement>
        <p>
          Show that in <xref ref="def-delta-ring"/>, condition <xref ref="eq-delta-ring-value-at-1"/> cannot be omitted.
        </p>
      </statement>
      <hint>
        <p>
          Check that the map <m>\delta(x) = -x^p</m> satisfies the other conditions. (Note that it corresponds to <m>\phi</m> being the zero map, which is additive
          and multiplicative but not a homomorphism of unital rings.)
        </p>
      </hint>
    </exercise>
    <exercise>
      <statement>
        <p>
          Suppose that <m>p=2</m>. For <m>x,y</m> in a <m>\delta</m>-ring, compute <m>\delta(\delta(xy))</m> and <m>\delta(\delta(x+y))</m>.
        </p>
      </statement>
    </exercise>
    <exercise>
      <statement>
        <p>
          Assume that <m>p > 2</m>.
          Show that in <xref ref="exa-delta-ring-cyclotomic"/>, if we replace <m>A</m> with <m>A[\zeta_p]</m> and extend the map so that it fixes <m>\zeta_p</m>,
          we get an endomorphism which is not a Frobenius lift. (There is a more permissive definition of Frobenius lifts that would allow this, but it does not
          integrate neatly with the theory of <m>\delta</m>-rings.)
        </p>
      </statement>
    </exercise>
    <exercise xml:id="exer-delta-ring-p-power-torsion">
      <statement>
        <p>
          Prove the following refinement of <xref ref="lem-delta-ring-killed-by-p"/>: in any <m>\delta</m>-ring, every <m>p</m>-power-torsion element is nilpotent.
          In particular, any reduced <m>\delta</m>-ring is <m>p</m>-torsion-free.
        </p>
      </statement>
      <hint>
        <p>
          Adapt the proof of <xref ref="lem-delta-p-torsion"/> to show that if <m>p^n x = 0</m>, then <m>p^{n-1} \phi(x) = 0</m>.
          See also <xref ref="bib-Bhatt-Scholze"/>, Lemma 2.28.
        </p>
      </hint>
    </exercise>
    <exercise>
      <statement>
        <p>
          Let <m>A</m> be a <m>\delta</m>-ring whose underlying ring is <m>p</m>-adically separated. Show that any element of <m>A</m> which admits <m>p^n</m>-th roots in <m>A</m> for all positive integers <m>n</m> must be <m>\delta</m>-constant.
        </p>
      </statement>
      <hint>
        <p>
          It is enough to show that for each positive integer <m>n</m>, for any <m>y \in A</m> we have <m>\delta(y^{p^n}) \in p^n A</m>.
          This can be checked by reducing to the <m>p</m>-torsion-free case and computing in terms of <m>\phi</m>.
        </p>
      </hint>
    </exercise>
    <exercise>
      <statement>
        <p>
          Let <m>A</m> be a <m>\delta</m>-ring and let <m>x \in A</m> be an element. Prove that there exists a faithfully flat map <m>A \to B</m> of <m>\delta</m>-rings such that the image of <m>x</m> in <m>B</m> belongs to the image of <m>\phi</m>.
          That is, <q><m>\phi</m> is fpqc-locally surjective</q>.
        </p>
      </statement>
      <hint>
        <p>
          See <xref ref="bib-Bhatt-Scholze"/>, Corollary 2.12.
        </p>
      </hint>
    </exercise>
    <exercise xml:id="exer-delta-divided-power">
      <statement>
        <p>
          Let <m>A</m> be a <m>p</m>-torsion-free <m>\delta</m>-ring. Define the <term>divided power operations</term> <m>\gamma_n: A \to A[p^{-1}]</m> by
          <me>
            \gamma_n(x) = \frac{x^n}{n!}.
          </me>
          Show that if <m>x \in A</m> satisfies <m>\gamma_p(x) \in A</m>, then <m>\gamma_n(x) \in A</m> for all <m>n \geq 0</m>.
        </p>
      </statement>
      <hint>
        <p>
          See <xref ref="bib-Bhatt-Scholze"/>, Lemma 2.35.
        </p>
      </hint>
    </exercise>
    <exercise>
      <statement>
        <p>
          Starting with the ring <m>A = \ZZ_{(p)}\{x\}</m> (the free <m>\delta</m>-ring in <m>x</m> over <m>\ZZ_{(p)}</m>), let <m>D</m> be the <term>divided power envelope</term>
          of <m>A</m> with respect to the ideal <m>(x)</m>, that is, the smallest subring of <m>A[p^{-1}]</m> with the property that the divided power operations
          (<xref ref="exer-delta-divided-power"/>) carry every element of the ideal <m>xA</m> into <m>D</m>. (They also carry every element of the ideal <m>xD</m> into <m>D</m>.)
          Prove that <m>D = \ZZ_{(p)}\{x, \frac{\phi(x)}{p} \}</m>.
        </p>
      </statement>
      <hint>
        <p>
          See <xref ref="bib-Bhatt-Scholze"/>, Lemma 2.36.  
        </p>
      </hint>
    </exercise>
    <exercise xml:id="exer-delta-ring-completion">
      <statement>
        <p>
          Let <m>A</m> be a <m>\delta</m>-ring. Let <m>I</m> be a finitely generated ideal of <m>A</m> containing <m>p</m> (we do not assume any compatibility with <m>\delta</m>).
          Then the <m>I</m>-adic completion of <m>A</m> admits a unique <m>\delta</m>-structure compatible with <m>A</m>.
        </p>
      </statement>
      <hint>
        <p>
          See <xref ref="bib-Bhatt-Scholze"/>, Lemma 2.17.
        </p>
      </hint>
    </exercise>
    <exercise xml:id="exer-category-Frobenius-lift">
      <statement>
        <p>
          Let <m>\calC</m> be the category of rings equipped with a Frobenius lift.
        </p>
        <ol>
          <li>
            <p>
              Show that <m>\calC</m> admits arbitrary colimits and products, and that these commute with the forgetful functor to rings.
            </p>
          </li>
          <li>
            <p>
              Show that <m>\calC</m> does <em>not</em> admit equalizers (and hence does not admit arbitrary limits).
            </p>
          </li>
        </ol>
      </statement>
    </exercise>
  </exercises>
</section>